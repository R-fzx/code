(()=>{"use strict";var e={3126:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(3680),o=s(2593);var n;!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:r.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:r.Event.None}),e.is=function(t){let s=t;return s&&(s===e.None||s===e.Cancelled||o.boolean(s.isCancellationRequested)&&!!s.onCancellationRequested)}}(n=t.CancellationToken||(t.CancellationToken={}));const i=Object.freeze((function(e,t){let s=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(s)}}}));class a{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?i:(this._emitter||(this._emitter=new r.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}t.CancellationTokenSource=class{get token(){return this._token||(this._token=new a),this._token}cancel(){this._token?this._token.cancel():this._token=n.Cancelled}dispose(){this._token?this._token instanceof a&&this._token.dispose():this._token=n.None}}},3680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),(t.Disposable||(t.Disposable={})).create=function(e){return{dispose:e}},function(e){const t={dispose(){}};e.None=function(){return t}}(t.Event||(t.Event={}));class s{add(e,t=null,s){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(s)&&s.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(this._callbacks){for(var s=!1,r=0,o=this._callbacks.length;r<o;r++)if(this._callbacks[r]===e){if(this._contexts[r]===t)return this._callbacks.splice(r,1),void this._contexts.splice(r,1);s=!0}if(s)throw new Error("When adding a listener with a context, you should remove it with the same context")}}invoke(...e){if(!this._callbacks)return[];for(var t=[],s=this._callbacks.slice(0),r=this._contexts.slice(0),o=0,n=s.length;o<n;o++)try{t.push(s[o].apply(r[o],e))}catch(e){console.error(e)}return t}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,o)=>{let n;return this._callbacks||(this._callbacks=new s),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t),n={dispose:()=>{this._callbacks.remove(e,t),n.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this)}},Array.isArray(o)&&o.push(n),n}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}t.Emitter=r,r._noop=function(){}},2593:(e,t)=>{function s(e){return"string"==typeof e||e instanceof String}function r(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.boolean=function(e){return!0===e||!1===e},t.string=s,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=r,t.stringArray=function(e){return r(e)&&e.every((e=>s(e)))}},397:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.None=0,e.First=1,e.Last=2}(s=t.Touch||(t.Touch={})),t.LinkedMap=class{constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}has(e){return this._map.has(e)}get(e){const t=this._map.get(e);if(t)return t.value}set(e,t,r=s.None){let o=this._map.get(e);if(o)o.value=t,r!==s.None&&this.touch(o,r);else{switch(o={key:e,value:t,next:void 0,previous:void 0},r){case s.None:this.addItemLast(o);break;case s.First:this.addItemFirst(o);break;case s.Last:default:this.addItemLast(o)}this._map.set(e,o),this._size++}}delete(e){const t=this._map.get(e);return!!t&&(this._map.delete(e),this.removeItem(t),this._size--,!0)}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let s=this._head;for(;s;)t?e.bind(t)(s.value,s.key,this):e(s.value,s.key,this),s=s.next}forEachReverse(e,t){let s=this._tail;for(;s;)t?e.bind(t)(s.value,s.key,this):e(s.value,s.key,this),s=s.previous}values(){let e=[],t=this._head;for(;t;)e.push(t.value),t=t.next;return e}keys(){let e=[],t=this._head;for(;t;)e.push(t.key),t=t.next;return e}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head)this._head=e.next;else if(e===this._tail)this._tail=e.previous;else{const t=e.next,s=e.previous;if(!t||!s)throw new Error("Invalid list");t.previous=s,s.next=t}}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===s.First||t===s.Last)if(t===s.First){if(e===this._head)return;const t=e.next,s=e.previous;e===this._tail?(s.next=void 0,this._tail=s):(t.previous=s,s.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e}else if(t===s.Last){if(e===this._tail)return;const t=e.next,s=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=s,s.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e}}}},8231:(e,t,s)=>{function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0});const o=s(2593),n=s(3234);t.RequestType=n.RequestType,t.RequestType0=n.RequestType0,t.RequestType1=n.RequestType1,t.RequestType2=n.RequestType2,t.RequestType3=n.RequestType3,t.RequestType4=n.RequestType4,t.RequestType5=n.RequestType5,t.RequestType6=n.RequestType6,t.RequestType7=n.RequestType7,t.RequestType8=n.RequestType8,t.RequestType9=n.RequestType9,t.ResponseError=n.ResponseError,t.ErrorCodes=n.ErrorCodes,t.NotificationType=n.NotificationType,t.NotificationType0=n.NotificationType0,t.NotificationType1=n.NotificationType1,t.NotificationType2=n.NotificationType2,t.NotificationType3=n.NotificationType3,t.NotificationType4=n.NotificationType4,t.NotificationType5=n.NotificationType5,t.NotificationType6=n.NotificationType6,t.NotificationType7=n.NotificationType7,t.NotificationType8=n.NotificationType8,t.NotificationType9=n.NotificationType9;const i=s(6386);t.MessageReader=i.MessageReader,t.StreamMessageReader=i.StreamMessageReader,t.IPCMessageReader=i.IPCMessageReader,t.SocketMessageReader=i.SocketMessageReader;const a=s(9725);t.MessageWriter=a.MessageWriter,t.StreamMessageWriter=a.StreamMessageWriter,t.IPCMessageWriter=a.IPCMessageWriter,t.SocketMessageWriter=a.SocketMessageWriter;const c=s(3680);t.Disposable=c.Disposable,t.Event=c.Event,t.Emitter=c.Emitter;const l=s(3126);t.CancellationTokenSource=l.CancellationTokenSource,t.CancellationToken=l.CancellationToken;const u=s(397);var d,h,f,p,g,m,v,S;r(s(3377)),r(s(1609)),function(e){e.type=new n.NotificationType("$/cancelRequest")}(d||(d={})),function(e){e.type=new n.NotificationType("$/progress")}(h||(h={})),t.ProgressType=class{constructor(){}},t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Verbose=2]="Verbose"}(f=t.Trace||(t.Trace={})),function(e){e.fromString=function(t){if(!o.string(t))return e.Off;switch(t=t.toLowerCase()){case"off":return e.Off;case"messages":return e.Messages;case"verbose":return e.Verbose;default:return e.Off}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Verbose:return"verbose";default:return"off"}}}(f=t.Trace||(t.Trace={})),function(e){e.Text="text",e.JSON="json"}(t.TraceFormat||(t.TraceFormat={})),function(e){e.fromString=function(t){return"json"===(t=t.toLowerCase())?e.JSON:e.Text}}(p=t.TraceFormat||(t.TraceFormat={})),function(e){e.type=new n.NotificationType("$/setTraceNotification")}(g=t.SetTraceNotification||(t.SetTraceNotification={})),function(e){e.type=new n.NotificationType("$/logTraceNotification")}(m=t.LogTraceNotification||(t.LogTraceNotification={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(v=t.ConnectionErrors||(t.ConnectionErrors={}));class y extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,y.prototype)}}function _(e,t,s,r){let i=0,a=0,_=0;const w="2.0";let E,T,b,R,C=Object.create(null),x=Object.create(null),N=new Map,k=new u.LinkedMap,O=Object.create(null),L=Object.create(null),M=f.Off,P=p.Text,W=S.New,$=new c.Emitter,D=new c.Emitter,q=new c.Emitter,A=new c.Emitter,I=new c.Emitter;function V(e){return"req-"+e.toString()}function j(e){}function F(){return W===S.Listening}function U(){return W===S.Closed}function H(){return W===S.Disposed}function B(){W!==S.New&&W!==S.Listening||(W=S.Closed,D.fire(void 0))}function J(){b||0===k.size||(b=setImmediate((()=>{b=void 0,function(){if(0===k.size)return;let e=k.shift();try{n.isRequestMessage(e)?function(e){if(H())return;function s(s,r,o){let i={jsonrpc:w,id:e.id};s instanceof n.ResponseError?i.error=s.toJson():i.result=void 0===s?null:s,X(i,r,o),t.write(i)}function r(s,r,o){let n={jsonrpc:w,id:e.id,error:s.toJson()};X(n,r,o),t.write(n)}!function(e){if(M!==f.Off&&R)if(P===p.Text){let t;M===f.Verbose&&e.params&&(t=`Params: ${JSON.stringify(e.params,null,4)}\n\n`),R.log(`Received request '${e.method} - (${e.id})'.`,t)}else Y("receive-request",e)}(e);let i,a,c=C[e.method];c&&(i=c.type,a=c.handler);let u=Date.now();if(a||E){let c=new l.CancellationTokenSource,d=String(e.id);L[d]=c;try{let l;l=void 0===e.params||void 0!==i&&0===i.numberOfParams?a?a(c.token):E(e.method,c.token):o.array(e.params)&&(void 0===i||i.numberOfParams>1)?a?a(...e.params,c.token):E(e.method,...e.params,c.token):a?a(e.params,c.token):E(e.method,e.params,c.token);let h=l;l?h.then?h.then((t=>{delete L[d],s(t,e.method,u)}),(t=>{delete L[d],t instanceof n.ResponseError?r(t,e.method,u):t&&o.string(t.message)?r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,u):r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,u)})):(delete L[d],s(l,e.method,u)):(delete L[d],function(s,r,o){void 0===s&&(s=null);let n={jsonrpc:w,id:e.id,result:s};X(n,r,o),t.write(n)}(l,e.method,u))}catch(t){delete L[d],t instanceof n.ResponseError?s(t,e.method,u):t&&o.string(t.message)?r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,u):r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,u)}}else r(new n.ResponseError(n.ErrorCodes.MethodNotFound,`Unhandled method ${e.method}`),e.method,u)}(e):n.isNotificationMessage(e)?function(e){if(H())return;let t,r;if(e.method===d.type.method)r=e=>{let t=e.id,s=L[String(t)];s&&s.cancel()};else{let s=x[e.method];s&&(r=s.handler,t=s.type)}if(r||T)try{!function(e){if(M!==f.Off&&R&&e.method!==m.type.method)if(P===p.Text){let t;M===f.Verbose&&(t=e.params?`Params: ${JSON.stringify(e.params,null,4)}\n\n`:"No parameters provided.\n\n"),R.log(`Received notification '${e.method}'.`,t)}else Y("receive-notification",e)}(e),void 0===e.params||void 0!==t&&0===t.numberOfParams?r?r():T(e.method):o.array(e.params)&&(void 0===t||t.numberOfParams>1)?r?r(...e.params):T(e.method,...e.params):r?r(e.params):T(e.method,e.params)}catch(t){t.message?s.error(`Notification handler '${e.method}' failed with message: ${t.message}`):s.error(`Notification handler '${e.method}' failed unexpectedly.`)}else q.fire(e)}(e):n.isResponseMessage(e)?function(e){if(!H())if(null===e.id)e.error?s.error(`Received response message without id: Error is: \n${JSON.stringify(e.error,void 0,4)}`):s.error("Received response message without id. No further error information provided.");else{let t=String(e.id),r=O[t];if(function(e,t){if(M!==f.Off&&R)if(P===p.Text){let s;if(M===f.Verbose&&(e.error&&e.error.data?s=`Error data: ${JSON.stringify(e.error.data,null,4)}\n\n`:e.result?s=`Result: ${JSON.stringify(e.result,null,4)}\n\n`:void 0===e.error&&(s="No result returned.\n\n")),t){let r=e.error?` Request failed: ${e.error.message} (${e.error.code}).`:"";R.log(`Received response '${t.method} - (${e.id})' in ${Date.now()-t.timerStart}ms.${r}`,s)}else R.log(`Received response ${e.id} without active response promise.`,s)}else Y("receive-response",e)}(e,r),r){delete O[t];try{if(e.error){let t=e.error;r.reject(new n.ResponseError(t.code,t.message,t.data))}else{if(void 0===e.result)throw new Error("Should never happen.");r.resolve(e.result)}}catch(e){e.message?s.error(`Response handler '${r.method}' failed with message: ${e.message}`):s.error(`Response handler '${r.method}' failed unexpectedly.`)}}}}(e):function(e){if(!e)return void s.error("Received empty message.");s.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(e,null,4)}`);let t=e;if(o.string(t.id)||o.number(t.id)){let e=String(t.id),s=O[e];s&&s.reject(new Error("The received response has neither a result nor an error property."))}}(e)}finally{J()}}()})))}e.onClose(B),e.onError((function(e){$.fire([e,void 0,void 0])})),t.onClose(B),t.onError((function(e){$.fire(e)}));let z=e=>{try{if(n.isNotificationMessage(e)&&e.method===d.type.method){let s=V(e.params.id),o=k.get(s);if(n.isRequestMessage(o)){let n=r&&r.cancelUndispatched?r.cancelUndispatched(o,j):void 0;if(n&&(void 0!==n.error||void 0!==n.result))return k.delete(s),n.id=o.id,X(n,e.method,Date.now()),void t.write(n)}}!function(e,t){var s;n.isRequestMessage(t)?e.set(V(t.id),t):n.isResponseMessage(t)?e.set(null===(s=t.id)?"res-unknown-"+(++_).toString():"res-"+s.toString(),t):e.set("not-"+(++a).toString(),t)}(k,e)}finally{J()}};function X(e,t,s){if(M!==f.Off&&R)if(P===p.Text){let r;M===f.Verbose&&(e.error&&e.error.data?r=`Error data: ${JSON.stringify(e.error.data,null,4)}\n\n`:e.result?r=`Result: ${JSON.stringify(e.result,null,4)}\n\n`:void 0===e.error&&(r="No result returned.\n\n")),R.log(`Sending response '${t} - (${e.id})'. Processing request took ${Date.now()-s}ms`,r)}else Y("send-response",e)}function Y(e,t){if(!R||M===f.Off)return;const s={isLSPMessage:!0,type:e,message:t,timestamp:Date.now()};R.log(s)}function G(){if(U())throw new y(v.Closed,"Connection is closed.");if(H())throw new y(v.Disposed,"Connection is disposed.")}function Q(e){return void 0===e?null:e}function Z(e,t){let s,r=e.numberOfParams;switch(r){case 0:s=null;break;case 1:s=Q(t[0]);break;default:s=[];for(let e=0;e<t.length&&e<r;e++)s.push(Q(t[e]));if(t.length<r)for(let e=t.length;e<r;e++)s.push(null)}return s}let K={sendNotification:(e,...s)=>{let r,n;if(G(),o.string(e))switch(r=e,s.length){case 0:n=null;break;case 1:n=s[0];break;default:n=s}else r=e.method,n=Z(e,s);let i={jsonrpc:w,method:r,params:n};!function(e){if(M!==f.Off&&R)if(P===p.Text){let t;M===f.Verbose&&(t=e.params?`Params: ${JSON.stringify(e.params,null,4)}\n\n`:"No parameters provided.\n\n"),R.log(`Sending notification '${e.method}'.`,t)}else Y("send-notification",e)}(i),t.write(i)},onNotification:(e,t)=>{G(),o.func(e)?T=e:t&&(o.string(e)?x[e]={type:void 0,handler:t}:x[e.method]={type:e,handler:t})},onProgress:(e,t,s)=>{if(N.has(t))throw new Error(`Progress handler for token ${t} already registered`);return N.set(t,s),{dispose:()=>{N.delete(t)}}},sendProgress:(e,t,s)=>{K.sendNotification(h.type,{token:t,value:s})},onUnhandledProgress:A.event,sendRequest:(e,...s)=>{let r,a,c;if(G(),function(){if(!F())throw new Error("Call listen() first.")}(),o.string(e))switch(r=e,s.length){case 0:a=null;break;case 1:l.CancellationToken.is(s[0])?(a=null,c=s[0]):a=Q(s[0]);break;default:const e=s.length-1;l.CancellationToken.is(s[e])?(c=s[e],a=2===s.length?Q(s[0]):s.slice(0,e).map((e=>Q(e)))):a=s.map((e=>Q(e)))}else{r=e.method,a=Z(e,s);let t=e.numberOfParams;c=l.CancellationToken.is(s[t])?s[t]:void 0}let u=i++,h=new Promise(((e,s)=>{let o={jsonrpc:w,id:u,method:r,params:a},i={method:r,timerStart:Date.now(),resolve:e,reject:s};!function(e){if(M!==f.Off&&R)if(P===p.Text){let t;M===f.Verbose&&e.params&&(t=`Params: ${JSON.stringify(e.params,null,4)}\n\n`),R.log(`Sending request '${e.method} - (${e.id})'.`,t)}else Y("send-request",e)}(o);try{t.write(o)}catch(e){i.reject(new n.ResponseError(n.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),i=null}i&&(O[String(u)]=i)}));return c&&c.onCancellationRequested((()=>{K.sendNotification(d.type,{id:u})})),h},onRequest:(e,t)=>{G(),o.func(e)?E=e:t&&(o.string(e)?C[e]={type:void 0,handler:t}:C[e.method]={type:e,handler:t})},trace:(e,t,s)=>{let r=!1,n=p.Text;void 0!==s&&(o.boolean(s)?r=s:(r=s.sendNotification||!1,n=s.traceFormat||p.Text)),M=e,P=n,R=M===f.Off?void 0:t,!r||U()||H()||K.sendNotification(g.type,{value:f.toString(e)})},onError:$.event,onClose:D.event,onUnhandledNotification:q.event,onDispose:I.event,dispose:()=>{if(H())return;W=S.Disposed,I.fire(void 0);let s=new Error("Connection got disposed.");Object.keys(O).forEach((e=>{O[e].reject(s)})),O=Object.create(null),L=Object.create(null),k=new u.LinkedMap,o.func(t.dispose)&&t.dispose(),o.func(e.dispose)&&e.dispose()},listen:()=>{G(),function(){if(F())throw new y(v.AlreadyListening,"Connection is already listening")}(),W=S.Listening,e.listen(z)},inspect:()=>{console.log("inspect")}};return K.onNotification(m.type,(e=>{M!==f.Off&&R&&R.log(e.message,M===f.Verbose?e.verbose:void 0)})),K.onNotification(h.type,(e=>{const t=N.get(e.token);t?t(e.value):A.fire(e)})),K}t.ConnectionError=y,(t.ConnectionStrategy||(t.ConnectionStrategy={})).is=function(e){let t=e;return t&&o.func(t.cancelUndispatched)},function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(S||(S={})),t.createMessageConnection=function(e,s,r,o){var n;return r||(r=t.NullLogger),_(void 0!==(n=e).listen&&void 0===n.read?e:new i.StreamMessageReader(e),function(e){return void 0!==e.write&&void 0===e.end}(s)?s:new a.StreamMessageWriter(s),r,o)}},6386:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(3680),o=s(2593);let n=8192,i=Buffer.from("\r","ascii")[0],a=Buffer.from("\n","ascii")[0];class c{constructor(e="utf8"){this.encoding=e,this.index=0,this.buffer=Buffer.allocUnsafe(n)}append(e){var t=e;if("string"==typeof e){var s=e,r=Buffer.byteLength(s,this.encoding);(t=Buffer.allocUnsafe(r)).write(s,0,r,this.encoding)}if(this.buffer.length-this.index>=t.length)t.copy(this.buffer,this.index,0,t.length);else{var o=(Math.ceil((this.index+t.length)/n)+1)*n;0===this.index?(this.buffer=Buffer.allocUnsafe(o),t.copy(this.buffer,0,0,t.length)):this.buffer=Buffer.concat([this.buffer.slice(0,this.index),t],o)}this.index+=t.length}tryReadHeaders(){let e,t=0;for(;t+3<this.index&&(this.buffer[t]!==i||this.buffer[t+1]!==a||this.buffer[t+2]!==i||this.buffer[t+3]!==a);)t++;if(t+3>=this.index)return e;e=Object.create(null),this.buffer.toString("ascii",0,t).split("\r\n").forEach((t=>{let s=t.indexOf(":");if(-1===s)throw new Error("Message header must separate key and value using :");let r=t.substr(0,s),o=t.substr(s+1).trim();e[r]=o}));let s=t+4;return this.buffer=this.buffer.slice(s),this.index=this.index-s,e}tryReadContent(e){if(this.index<e)return null;let t=this.buffer.toString(this.encoding,0,e),s=e;return this.buffer.copy(this.buffer,0,s),this.index=this.index-s,t}get numberOfBytes(){return this.index}}(t.MessageReader||(t.MessageReader={})).is=function(e){let t=e;return t&&o.func(t.listen)&&o.func(t.dispose)&&o.func(t.onError)&&o.func(t.onClose)&&o.func(t.onPartialMessage)};class l{constructor(){this.errorEmitter=new r.Emitter,this.closeEmitter=new r.Emitter,this.partialMessageEmitter=new r.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${o.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageReader=l;class u extends l{constructor(e,t="utf8"){super(),this.readable=e,this.buffer=new c(t),this._partialMessageTimeout=1e4}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e,this.readable.on("data",(e=>{this.onData(e)})),this.readable.on("error",(e=>this.fireError(e))),this.readable.on("close",(()=>this.fireClose()))}onData(e){for(this.buffer.append(e);;){if(-1===this.nextMessageLength){let e=this.buffer.tryReadHeaders();if(!e)return;let t=e["Content-Length"];if(!t)throw new Error("Header must provide a Content-Length property.");let s=parseInt(t);if(isNaN(s))throw new Error("Content-Length value must be a number.");this.nextMessageLength=s}var t=this.buffer.tryReadContent(this.nextMessageLength);if(null===t)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.messageToken++;var s=JSON.parse(t);this.callback(s)}}clearPartialMessageTimer(){this.partialMessageTimer&&(clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=setTimeout(((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())}),this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}t.StreamMessageReader=u,t.IPCMessageReader=class extends l{constructor(e){super(),this.process=e;let t=this.process;t.on("error",(e=>this.fireError(e))),t.on("close",(()=>this.fireClose()))}listen(e){this.process.on("message",e)}},t.SocketMessageReader=class extends u{constructor(e,t="utf-8"){super(e,t)}}},9725:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(3680),o=s(2593);let n="Content-Length: ",i="\r\n";(t.MessageWriter||(t.MessageWriter={})).is=function(e){let t=e;return t&&o.func(t.dispose)&&o.func(t.onClose)&&o.func(t.onError)&&o.func(t.write)};class a{constructor(){this.errorEmitter=new r.Emitter,this.closeEmitter=new r.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,s){this.errorEmitter.fire([this.asError(e),t,s])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${o.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageWriter=a,t.StreamMessageWriter=class extends a{constructor(e,t="utf8"){super(),this.writable=e,this.encoding=t,this.errorCount=0,this.writable.on("error",(e=>this.fireError(e))),this.writable.on("close",(()=>this.fireClose()))}write(e){let t=JSON.stringify(e),s=Buffer.byteLength(t,this.encoding),r=[n,s.toString(),i,i];try{this.writable.write(r.join(""),"ascii"),this.writable.write(t,this.encoding),this.errorCount=0}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}},t.IPCMessageWriter=class extends a{constructor(e){super(),this.process=e,this.errorCount=0,this.queue=[],this.sending=!1;let t=this.process;t.on("error",(e=>this.fireError(e))),t.on("close",(()=>this.fireClose))}write(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)}doWriteMessage(e){try{this.process.send&&(this.sending=!0,this.process.send(e,void 0,void 0,(t=>{this.sending=!1,t?(this.errorCount++,this.fireError(t,e,this.errorCount)):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())})))}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}},t.SocketMessageWriter=class extends a{constructor(e,t="utf8"){super(),this.socket=e,this.queue=[],this.sending=!1,this.encoding=t,this.errorCount=0,this.socket.on("error",(e=>this.fireError(e))),this.socket.on("close",(()=>this.fireClose()))}dispose(){super.dispose(),this.socket.destroy()}write(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)}doWriteMessage(e){let t=JSON.stringify(e),s=Buffer.byteLength(t,this.encoding),r=[n,s.toString(),i,i];try{this.sending=!0,this.socket.write(r.join(""),"ascii",(s=>{s&&this.handleError(s,e);try{this.socket.write(t,this.encoding,(t=>{this.sending=!1,t?this.handleError(t,e):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())}))}catch(s){this.handleError(s,e)}}))}catch(t){this.handleError(t,e)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}}},3234:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(2593);var o;!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.serverErrorStart=-32099,e.serverErrorEnd=-32e3,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.RequestCancelled=-32800,e.ContentModified=-32801,e.MessageWriteError=1,e.MessageReadError=2}(o=t.ErrorCodes||(t.ErrorCodes={}));class n extends Error{constructor(e,t,s){super(t),this.code=r.number(e)?e:o.UnknownErrorCode,this.data=s,Object.setPrototypeOf(this,n.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}}t.ResponseError=n;class i{constructor(e,t){this._method=e,this._numberOfParams=t}get method(){return this._method}get numberOfParams(){return this._numberOfParams}}t.AbstractMessageType=i,t.RequestType0=class extends i{constructor(e){super(e,0)}},t.RequestType=class extends i{constructor(e){super(e,1)}},t.RequestType1=class extends i{constructor(e){super(e,1)}},t.RequestType2=class extends i{constructor(e){super(e,2)}},t.RequestType3=class extends i{constructor(e){super(e,3)}},t.RequestType4=class extends i{constructor(e){super(e,4)}},t.RequestType5=class extends i{constructor(e){super(e,5)}},t.RequestType6=class extends i{constructor(e){super(e,6)}},t.RequestType7=class extends i{constructor(e){super(e,7)}},t.RequestType8=class extends i{constructor(e){super(e,8)}},t.RequestType9=class extends i{constructor(e){super(e,9)}},t.NotificationType=class extends i{constructor(e){super(e,1),this._=void 0}},t.NotificationType0=class extends i{constructor(e){super(e,0)}},t.NotificationType1=class extends i{constructor(e){super(e,1)}},t.NotificationType2=class extends i{constructor(e){super(e,2)}},t.NotificationType3=class extends i{constructor(e){super(e,3)}},t.NotificationType4=class extends i{constructor(e){super(e,4)}},t.NotificationType5=class extends i{constructor(e){super(e,5)}},t.NotificationType6=class extends i{constructor(e){super(e,6)}},t.NotificationType7=class extends i{constructor(e){super(e,7)}},t.NotificationType8=class extends i{constructor(e){super(e,8)}},t.NotificationType9=class extends i{constructor(e){super(e,9)}},t.isRequestMessage=function(e){let t=e;return t&&r.string(t.method)&&(r.string(t.id)||r.number(t.id))},t.isNotificationMessage=function(e){let t=e;return t&&r.string(t.method)&&void 0===e.id},t.isResponseMessage=function(e){let t=e;return t&&(void 0!==t.result||!!t.error)&&(r.string(t.id)||r.number(t.id)||null===t.id)}},3377:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(5622),o=s(2087),n=s(6417),i=s(1631),a=s(6386),c=s(9725);t.generateRandomPipeName=function(){const e=n.randomBytes(21).toString("hex");return"win32"===process.platform?`\\\\.\\pipe\\vscode-jsonrpc-${e}-sock`:r.join(o.tmpdir(),`vscode-${e}.sock`)},t.createClientPipeTransport=function(e,t="utf-8"){let s,r=new Promise(((e,t)=>{s=e}));return new Promise(((o,n)=>{let l=i.createServer((e=>{l.close(),s([new a.SocketMessageReader(e,t),new c.SocketMessageWriter(e,t)])}));l.on("error",n),l.listen(e,(()=>{l.removeListener("error",n),o({onConnected:()=>r})}))}))},t.createServerPipeTransport=function(e,t="utf-8"){const s=i.createConnection(e);return[new a.SocketMessageReader(s,t),new c.SocketMessageWriter(s,t)]}},1609:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1631),o=s(6386),n=s(9725);t.createClientSocketTransport=function(e,t="utf-8"){let s,i=new Promise(((e,t)=>{s=e}));return new Promise(((a,c)=>{let l=r.createServer((e=>{l.close(),s([new o.SocketMessageReader(e,t),new n.SocketMessageWriter(e,t)])}));l.on("error",c),l.listen(e,"127.0.0.1",(()=>{l.removeListener("error",c),a({onConnected:()=>i})}))}))},t.createServerSocketTransport=function(e,t="utf-8"){const s=r.createConnection(e,"127.0.0.1");return[new o.SocketMessageReader(s,t),new n.SocketMessageWriter(s,t)]}},7631:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FailureReason=t.DownloadLog=t.DownloadProgress=t.MakeDefaultRequest=t.DownloadRequest=t.FatalErrorOccured=t.PortResolved=t.Stderr=t.Stdout=t.Progress=void 0;const r=s(8231);var o;t.Progress=new r.NotificationType("progressNotification"),t.Stdout=new r.NotificationType("stdoutNotification"),t.Stderr=new r.NotificationType("stderrNotification"),t.PortResolved=new r.NotificationType("portResolvedNotification"),t.FatalErrorOccured=new r.NotificationType("fatalErrorOccuredNotification"),t.DownloadRequest=new r.RequestType("downloadRequest"),t.MakeDefaultRequest=new r.RequestType("makeDefault"),t.DownloadProgress=new r.ProgressType,t.DownloadLog=new r.ProgressType,(o=t.FailureReason||(t.FailureReason={})).ServerScriptError="servererror",o.ServerCloseError="serverclose",o.Timeout="timeout",o.WSLNotFound="wslnotfound",o.WSLUpdateRequired="wslupdaterequired",o.Undefined="undefined"},4314:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomPort=t.isWSL1=t.fileExists=t.getServerTarCacheLocation=t.donwloadBuild=t.getDownloadURL=t.escapeForDoubleQuotes=t.escapeQuotes=t.toForwardSlashes=t.parseDistros=t.getDistros=t.Distro=t.indexOfDistro=t.getDistroFromAuthority=t.isDockerDesktopDistro=t.isAuthorityWsl=t.isEqualAuthority=t.startsWithCaseInsensitive=t.compareCaseInsensitive=t.getAuthorityFromDistro=t.ALPINE_DISTRO=t.ALPINE_AUTHORITY=t.DEFAULT_AUTHORITY=t.getProductConfiguration=t.getWindowsBuildNumber=t.getWSLConfigExecutablePath=t.isWSLInstalled=t.getWSLExecutablePath=t.executeCommand=t.executeWslPath=t.getExecSyncOptions=t.isWSLInExplorerAvailable=t.isExecAndDistroArgumentSupported=t.isWSLEnvAvailable=t.isWSLPathAvailable=t.isDistroEnvVarAvailable=t.WIN10_1803=t.WIN10_1903=t.WIN10_2004=t.WIN10_21H1=void 0;const r=s(5622),o=s(2087),n=s(5747),i=s(3129),a=s(7211),c=s(6417),l=s(1669);function u(){return v()>=17666}function d(e={}){return{env:e,stdio:[null,null,null]}}function h(e,t,s){const o=f();if(!o)throw new Error("wsl command not found\n\nMake sure WSL is installed:\nhttps://aka.ms/vscode-remote/wsl/install-wsl");const n=d(t);let a=[];return u()?a.push("-d",s,"sh","-c",e):"wsl.exe"===r.basename(o).toLowerCase()?a.push("sh","-c",e):a.push("-c",e),i.execFileSync(o,a,n).toString()}function f(){let e=v()>=16299;const t=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432"),s=process.env.SystemRoot;if(s)return r.join(s,t?"Sysnative":"System32",e?"wsl.exe":"bash.exe")}function p(){const e=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432"),t=process.env.SystemRoot;if(t)return r.join(t,e?"Sysnative":"System32","wslconfig.exe")}let g,m;function v(){if("number"!=typeof g){const e="win32"===process.platform&&/(\d+)\.(\d+)\.(\d+)/g.exec(o.release());g=e&&4===e.length?parseInt(e[3]):0}return g}function S(e,t){return e.length===t.length&&(e===t||e.toLowerCase()===t.toLowerCase())}function y(e){return/^wsl\+/.test(e)}t.WIN10_21H1={label:"Windows 10, May 2021 Update, version 21H1",build:19043},t.WIN10_2004={label:"Windows 10, May 2020 Update, version 2004",build:19041},t.WIN10_1903={label:"Windows 10, May 2019 Update, version 1903",build:18362},t.WIN10_1803={label:"Windows 10, April 2018 Update, version 1803",build:17134},t.isDistroEnvVarAvailable=function(){return v()>=t.WIN10_1903.build},t.isWSLPathAvailable=function(){return v()>=17046},t.isWSLEnvAvailable=function(){return v()>=17063},t.isExecAndDistroArgumentSupported=u,t.isWSLInExplorerAvailable=function(){return v()>=18342},t.getExecSyncOptions=d,t.executeWslPath=function(e,t,s){return t?h('echo "$VSCODE_WSL_PATH"',{WSLENV:"VSCODE_WSL_PATH/up",VSCODE_WSL_PATH:e},s).trim():h('wslpath -w "$VSCODE_WSL_PATH"',{WSLENV:"VSCODE_WSL_PATH/u",VSCODE_WSL_PATH:e},s).trim()},t.executeCommand=h,t.getWSLExecutablePath=f,t.isWSLInstalled=async function(){if(v()>=22e3){const e=f();return e?await T(e)?new Promise((t=>{i.execFile(e,["--status"],(e=>{t(!e||"--status exits with error")}))})):`'${e}' not found`:"Environment variable 'SystemRoot' not defined"}{const e=function(){const e=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432"),t=process.env.SystemRoot;if(t)return r.join(t,e?"Sysnative":"System32","lxss","LxssManager.dll")}();return e?!!await T(e)||`'${e}' not found`:"Environment variable 'SystemRoot' not defined"}},t.getWSLConfigExecutablePath=p,t.getWindowsBuildNumber=v,t.getProductConfiguration=function(e){if(!m){const t=n.readFileSync(r.join(e,"product.json")).toString();m=JSON.parse(t)}return m},t.DEFAULT_AUTHORITY="wsl+default",t.ALPINE_AUTHORITY="wsl+Alpine",t.ALPINE_DISTRO="Alpine",t.getAuthorityFromDistro=function(e){return e?"wsl+"+e:t.DEFAULT_AUTHORITY},t.compareCaseInsensitive=S,t.startsWithCaseInsensitive=function(e,t){return e.substr(0,t.length).toLowerCase()===t.toLowerCase()},t.isEqualAuthority=function(e,t){return S(e,t)},t.isAuthorityWsl=y,t.isDockerDesktopDistro=function(e){return/^docker-desktop(-data)?$/.test(e)},t.getDistroFromAuthority=function(e){if(y(e)){const t=e.substr(4);return"default"===t?void 0:t}throw new Error("authority must start with wsl+")},t.indexOfDistro=function(e,t){for(let s=0;s<e.length;s++)if(S(t,e[s].name))return s;return-1};class _{constructor(e,t,s){this.name=e,this.isDefault=t,this.version=s}isInternal(){return!this.isDefault||/^docker-desktop(-data)?$/.test(this.name)}getAuthority(){return"wsl+"+this.name}}function w(e,t){const s=/\r\n/.test(e)?"\r\n":"\n",r=e.split(s),o=t?/^(?<default>\*|\s)\s*(?<name>[a-zA-Z0-9\.\-_]+)\s+(?<state>\w+)\s+(?<version>\d)/:/^(?<name>[a-zA-Z0-9\.\-_]+)/,n=[];for(let e=1;e<r.length;e++){let t=o.exec(r[e]);if(null==t?void 0:t.groups){const s=t.groups.name,r=t.groups.version,o=1===e;n.push(new _(s,o,r))}}return n}function E(e,t,s,r,o=5,i){return new Promise(((l,u)=>{const d=e=>{n.unlink(t,(()=>{})),u(e)},h=n.createWriteStream(t);a.get(e,(a=>{const f=a.headers["x-sha256"];if(i||"string"!=typeof f||(i=f),o>0&&(a.statusCode>=300&&a.statusCode<=303||307===a.statusCode)){const e=a.headers.location;if(e)return void E(e,t,s,r,o-1,i).then(l,u)}if(a.statusCode<200||a.statusCode>299)return void u(`Failed to download VS Code Server from ${e}: HTTP ${a.statusCode} - ${a.statusMessage}`);r(`Download checksum: ${i}`);const p=parseInt(a.headers["content-length"]||"0");if(p){let e=0,t=0;a.on("data",(r=>{e+=r.length,t++%8==0&&s({received:e,total:p})}))}a.on("error",d),a.pipe(h),a.on("end",(e=>{if(i){const e=c.createHash("sha256"),s=n.createReadStream(t);s.on("readable",(()=>{const t=s.read();t?e.update(t):i!==e.digest("hex")?d("Download checksum does not match."):(r("Download checksum verified"),l())}))}else l()}))})).on("error",d)}))}async function T(e){return(0,l.promisify)(n.exists)(e)}async function b(e){await T(e)||(await b(r.dirname(e)),await(0,l.promisify)(n.mkdir)(e))}t.Distro=_,t.getDistros=function(){return new Promise(((e,s)=>{let r,o,n;if(v()>=t.WIN10_21H1.build){if(r=f(),!r)return void s(new Error("Unable to find location of wsl.exe"));o=["--list","--verbose"],n=!0}else{if(r=p(),!r)return void s(new Error("Unable to find location of wslconfig.exe"));o=["/list"],n=!1}i.execFile(r,o,{windowsVerbatimArguments:!0,encoding:"utf16le"},((t,r,o)=>{t?s(t):e(w(r,n))}))}))},t.parseDistros=w,t.toForwardSlashes=function(e){return e.replace(/[\\/]/g,r.posix.sep)},t.escapeQuotes=function(e){return e.replace(/'/g,"'\"'\"'")},t.escapeForDoubleQuotes=function(e){return e.replace(/["$\\]/g,"\\$&")},t.getDownloadURL=function(e,t){return`${e.updateUrl}/commit:${e.commit||"dev"}/server-linux-${t}/${e.quality||"insider"}`},t.donwloadBuild=async function(e,t,s,o){await b(r.dirname(t));const i=`${t}_${Date.now()}`;return E(e,i,s,o).then((e=>(0,l.promisify)(n.rename)(i,t).then((e=>t))))},t.getServerTarCacheLocation=function(e,t){return r.join(o.tmpdir(),"vscode-remote-wsl",e.commit||"dev",`vscode-server-${e.quality}-linux-${t}.tar.gz`)},t.fileExists=T,t.isWSL1=function(e){return-1!==e.indexOf("Microsoft")},t.randomPort=function(){return 1025+Math.floor(64510*Math.random())}},3129:e=>{e.exports=require("child_process")},6417:e=>{e.exports=require("crypto")},5747:e=>{e.exports=require("fs")},7211:e=>{e.exports=require("https")},1631:e=>{e.exports=require("net")},2087:e=>{e.exports=require("os")},5622:e=>{e.exports=require("path")},1669:e=>{e.exports=require("util")}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0});const t=s(1631),o=s(3129),n=s(5747),i=s(8231),a=s(4314),c=s(5622),l=s(7631),u=process.env.VSCODE_WSL_AGENT_DEBUG_PORT,d=process.env.VSCODE_WSL_PIPE_NAME,h=parseInt(process.env.VSCODE_WSL_EXT_HOST_PID||"0",10),f=process.env.VSCODE_WSL_EXT_LOCATION,p=process.env.VSCODE_WSL_APP_ROOT,g=!!process.env.VSCODE_WSL_ENABLE_TELEMETRY,m=process.env.VSCODE_FILE_WATCHER_POLLING||0,v=process.env.VSCODE_WSL_DISTRO,S=!!process.env.VSCODE_WSL_DEBUG_INFO,y=process.env.VSCODE_WSL_DEFAULT_DISTRO;let _,w=[];const E=[];async function T(e){for(let t=0;t<w.length;t++)w[t]===e&&w.splice(t,1);0===w.length&&(_?setTimeout((()=>{0===w.length&&b()}),3e3):b())}function b(){try{E.forEach((e=>e())),R.close()}catch(e){}finally{process.exit(0)}}!function(){let e=i.createMessageConnection(new i.StreamMessageReader(process.stdin),new i.StreamMessageWriter(process.stdout));e.listen(),e.onRequest(((e,...t)=>{throw new Error("Received unexpected request")})),w.push(e);let t=setInterval((function(){try{process.kill(h,0)}catch(s){clearInterval(t),T(e)}}),1e3)}();const R=t.createServer((e=>{const t=i.createMessageConnection(new i.SocketMessageReader(e),new i.SocketMessageWriter(e));t.listen(),w.push(t),void 0!==_&&(t.sendNotification(l.Stdout,`Connecting to daemon started by other Remote-WSL window... ${_.wslVersion}`),t.sendNotification(l.PortResolved,_)),e.on("close",(()=>{T(t)}))}));function C(e){e&&"EADDRINUSE"===e.code||(console.error(e),process.exit(0));let s=e=>{console.error(e)},r=t.createConnection(d,(()=>{r.removeListener("error",s);const e=i.createMessageConnection(new i.SocketMessageReader(r),new i.SocketMessageWriter(r));e.listen();const t=w[0];e.onNotification(t.sendNotification),e.onRequest(t.sendRequest),e.onUnhandledProgress((e=>t.sendProgress(new i.ProgressType,e.token,e.value))),t.onNotification(e.sendNotification),t.onRequest(e.sendRequest),t.onUnhandledProgress((t=>e.sendProgress(new i.ProgressType,t.token,t.value))),r.on("close",(()=>{process.exit(0)}))}));r.once("error",s)}function x(e,t){w.forEach((s=>{s.sendNotification(e,t)}))}let N=0;function k(e,t,s){let r;if(e){const n=`kill ${s}`;r=(0,a.isExecAndDistroArgumentSupported)()?`${e} -d ${t} -e ${n}`:`${e} "${n}"`,x(l.Stdout,r);try{o.execSync(r,(0,a.getExecSyncOptions)())}catch(e){}}}R.on("error",C),R.listen(d,(async()=>{let e;R.removeListener("error",C);let t="",s=0,r="",i=[],d="";const h=(t,s,r,o=!1,n=!0)=>{clearTimeout(e),x(l.FatalErrorOccured,{message:t,wslVersion:d,checkLog:r,handled:o,modal:n,reason:s}),b()},T=e=>{const t=e.match(/(\d+)%$/);let o=0;if(t){const e=Math.min(parseInt(t[1],10),100);0===e&&(s=0),e>s&&(o=e-s,s=e)}const n=e;(r!==n||o>0)&&(r=n,x(l.Progress,{increment:45*o/100,message:n}))},O=()=>{let s=!1;if(P)P=!1,W=0,$&&(x(l.Progress,{increment:0,message:"Installing WSL components"}),$=!1);else if(W++,W>300)return void h(`VS Code Server for WSL failed to start. No messages received for ${Math.floor(90)}s`,l.FailureReason.Timeout,!0);return L.length&&(x(l.Stdout,L),s=(s=>{for(let r=0;r<s.length;r++){const o=s.charCodeAt(r);if(10===o){const s=t;t="";let r=s.match(/^WSL2-shell-PID: ([\d]+)/);if(r){const e=r[1];E.push((()=>{k(D,v,e)}));continue}if(r=s.match(/^Extension host agent listening on (\d+)/),r)return clearTimeout(e),_={hostNames:i,port:parseInt(r[1],10),wslVersion:d},x(l.PortResolved,_),!0;if(r=s.match(/^IP Address: ([\d\.]+)/),r){i.push(r[1]);continue}if(r=s.match(/^WSL version: (.+)/),r){d=r[1];continue}T(s)}else 8===o?t.length>0&&(t=t.substr(0,t.length-1)):t+=s.charAt(r)}return T(t),!1})(L),L=""),M.length&&(x(l.Stderr,M),M=""),s};let L="",M="",P=!1,W=0,$=!0;const D=(0,a.getWSLExecutablePath)();if(!D||!n.existsSync(D))return void h(`VS Code Server for WSL failed. '${D}' not found.\n\nMake sure WSL is installed:\nhttps://aka.ms/vscode-remote/wsl/install-wsl`,l.FailureReason.WSLNotFound,!1);if(!(0,a.isExecAndDistroArgumentSupported)()&&!(0,a.compareCaseInsensitive)(y,v)&&!await(q=v,A=y,w[0].sendRequest(l.MakeDefaultRequest,{distro:q,current:A})))return void h(`To open a non-distro, Remote-WSL requires a newer version of WSL: (${a.WIN10_1903.label}). `,l.FailureReason.WSLUpdateRequired,!1,!0);var q,A;e=setInterval(O,300);const I=(0,a.getProductConfiguration)(p),{commit:V,quality:j,serverDataFolderName:F}=I;if(V&&!j)return void h(`VSCode Client (${p}) does not define a quality.`,l.FailureReason.Undefined,!0);const U=F||".vscode-remote",H=(0,a.isWSLEnvAvailable)();let B="";if(V&&H){let e="";try{e=function(e,t,s,r){let n;const i=`[ -d ~/${s}/bin/${r} ] && printf found || ([ -f /etc/alpine-release ] && printf alpine-; uname -m)`;n=(0,a.isExecAndDistroArgumentSupported)()?`${e} -d ${t} -e sh -c "${i}"`:"wsl.exe"===(0,c.basename)(e).toLowerCase()?`${e} sh -c "${i}"`:`${e} -c "${i}"`,x(l.Stdout,`Probing if server is already installed: ${n}`);try{const e=o.execSync(n,(0,a.getExecSyncOptions)()).toString().trim();switch(x(l.Stdout,`Probing result: ${e}`),e){case"found":return"";case"x86_64":return"x64";case"aarch64":return"arm64";case"alpine-x86_64":return"alpine";default:x(l.Stderr,`${e} is an unsupported platform. Please file a feature request.`)}return"unknown"}catch(e){const t=[e.message];try{t.push(e.stdout.toString("utf16le")),t.push(e.stderr.toString("utf16le"))}catch(e){}throw new Error(t.join("\n"))}}(D,v,U,V),x(l.Stdout,e?`No server install found in WSL, needs ${e}`:"Server install found in WSL")}catch(e){x(l.Stderr,`Unable to detect if server is already installed: ${e}`),"string"==typeof e.message&&-1!==e.message.indexOf("https://aka.ms/wsl2kernel")&&h("WSL 2 requires an update to its kernel component. For instructions visit [here](https://aka.ms/wsl2kernel).",l.FailureReason.WSLUpdateRequired,!1,!1,!1);const t=(0,a.getWindowsBuildNumber)();t<=a.WIN10_1803.build?x(l.Stderr,`When using Alpine on ${a.WIN10_1803.label}, make sure that 'bash' is installed. ('apk update && apk add bash')${e}`):19555===t&&h("Currently, Remote - WSL does not work for WSL 2 in Build 19555.\nSee [WSL issue 4870](https://github.com/microsoft/WSL/issues/4870) for more information and workarounds.",l.FailureReason.WSLUpdateRequired,!0,!1,!1)}if(e&&"unknown"!==e){if(B=(0,a.getServerTarCacheLocation)(I,e),n.existsSync(B))x(l.Progress,{increment:45,message:""});else{const t=(0,a.getDownloadURL)(I,e);x(l.Stdout,`Downloading server on client side to ${B}.`),x(l.Stdout,`${t}`);let s=0;try{await function(e,t,r,o){const n=w[0],i=N++,a=N++,c=n.onProgress(l.DownloadProgress,i,(e=>{const t=Math.ceil(45*e.received/e.total);t>s&&(x(l.Progress,{increment:t-s,message:"Downloading server..."}),s=t),W=0})),u=n.onProgress(l.DownloadLog,a,(e=>{x(l.Stdout,e)}));return n.sendRequest(l.DownloadRequest,{url:e,target:t,progressToken:i,logToken:a}).finally((()=>{c.dispose(),u.dispose()}))}(t,B)}catch(e){x(l.Stderr,`Unable to download server on client side: ${e}. Will try to download on WSL side.`),B=""}}x(l.Progress,{increment:0,message:"Unpacking server..."})}else x(l.Progress,{increment:90,message:"Connecting to server..."})}const J=u?`--inspect=0.0.0.0:${u}`:"";let z=V?`"${H?"$VSCODE_WSL_EXT_LOCATION":"."}/scripts/wslServer.sh" ${V} ${j} ${U} ${m} ${J} ${g?"":"--disable-telemetry"}`:`"$VSCODE_WSL_EXT_LOCATION/scripts/wslServer-dev.sh" "$VSCODE_WSL_APP_ROOT" ${m} ${J}`;const X=[];S&&(z="env && VSCODE_WSL_DEBUG_INFO=true "+z),z=`'${z}'`,(0,a.isExecAndDistroArgumentSupported)()?X.push("-d",v,"sh","-c",z):"wsl.exe"===(0,c.basename)(D).toLowerCase()?X.push("sh","-c",z):X.push("-c",z);const Y=function(){const e={...process.env},t=Object.keys(e);for(const s of t)s.match(/^(ELECTRON_|VSCODE_)/)&&delete e[s];return e}();if(H||!V){const e=[];Y.VSCODE_WSL_EXT_LOCATION=f,e.push("VSCODE_WSL_EXT_LOCATION/up"),B&&(Y.VSCODE_SERVER_TAR=B,e.push("VSCODE_SERVER_TAR/up")),V||(Y.VSCODE_WSL_APP_ROOT=p,e.push("VSCODE_WSL_APP_ROOT/up")),Y.WSLENV&&e.push(process.env.WSLENV),Y.WSLENV=e.join(":")}let G=H?void 0:f;const Q=S?`, cwd: ${G}, env: ${JSON.stringify(Y,null,"  ")}`:"";x(l.Stdout,`Launching ${D} ${X.join(" ")}${Q}}`);const Z=o.spawn(D,X,{cwd:G,env:Y,windowsVerbatimArguments:!0});Z.stdout.on("data",(e=>{L+=e.toString(),P=!0})),Z.stderr.on("data",(e=>{M+=e.toString(),P=!0})),Z.on("error",(e=>{O()||h(`VS Code Server for WSL failed with error:\r\n${e.message}`,l.FailureReason.ServerScriptError,!0)})),Z.on("close",(e=>{O()||h("VS Code Server for WSL closed unexpectedly.",l.FailureReason.ServerCloseError,!0)}))}))})();var o=exports;for(var n in r)o[n]=r[n];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=wslDaemon.js.map