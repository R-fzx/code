要保证最短路不变，则连接这个点和根节点之间，至少有一条最短路未改动。

所以如果有些边不在最短路上，那么它们就一定会被删除。因为要保留的只有最短路上的，而最短路上的边要选择性删除。

如果一个点有多个点可以对它产生贡献，那么只能留一条边，其他的必须删除，此时的方案数就是可以对这个点产生贡献的数量。

最短路一下，设 $f_i$ 表示有多少个点可以对 $i$ 产生贡献。

如果找到更优的方案，则 $f_i = 1$，如果与最优解相等则 $f_i++$。

最后将 $f_i$ 相乘即可。

by Lightwhite.