考虑状压 $dp$，设 $f_{x, l, r}$ 表示状态为 $x$，开头为 $l$，末尾为 $r$ 的长度。

$x$ 就是一个二进制 $k$ 位的数，每一位上的1表示选入了这一位，0表示没有。

枚举要放进去的 $j$，放后状态为 $x'$，定义 $f1_{i, j}$ 表示在原串里每个长度为 $k$ 的格子中第 $i$ 和 $j$ 位不相同的个数。

则转移方程为 $f_{x', l, r} = f_{x, l, r} + f1_{i, j}$ 相同不用加入答案，不相同就不用抵消了。

定义 $f2_{i, j}$ 表示原串中每两个相邻的 $k$ 长度的格子中，前一个的第 $i$ 位和后一个的第 $j$ 位相同的个数，这样相同就必须减掉一个。

那么答案显然是 $min (f_{2 ^ k - 1, l, r} - f2_{l, r})$

显然 $f$ 数组将会超空间，通过石更木禾火大法发现 $l$ 基本不变，就删掉它力（不知道咋证明）

by Lightwhite.