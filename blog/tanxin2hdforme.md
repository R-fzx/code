# 浅谈贪心

## $\mathrm{I}$ 邻项交换法

这类贪心通常是将某个序列重排使某个属性最优，可以考虑相邻两项交换后变得更劣或不会变优的条件，按照此规则排序即可，注意需要满足严格弱序（具体见下）

---

[P1012 拼数](https://www.luogu.com.cn/problem/P1012)

假如 $a_i$ 在 $a_j$ 前面且交换 $a_i$ 和 $a_j$ 会导致答案更劣（注意到此时并不影响其他数），那么有 $a_i\times10^{|a_j|}+a_j>a_j\times10^{|a_i|}+a_i$，按照这个规则排序即可。

证明：

移项得到 $\dfrac{a_i}{10^{|a_i|}-1}>\dfrac{a_j}{10^{|a_j|}-1}$，正确性显然

---

[P1080 国王游戏](https://www.luogu.com.cn/problem/P1080)

假如第 $i$ 位大臣排在第 $j$ 位大臣前面，且交换 $i$ 和 $j$ 会导致答案更劣（注意到此时并不影响其他大臣），那么有 $\max(\dfrac{k}{b_i},\dfrac{ka_i}{b_j})<\max(\dfrac{k}{b_j},\dfrac{ka_j}{b_i})$（$k$ 是前面大臣的左手上的数的乘积，化简得到：

$$
\max(\dfrac{1}{b_i},\dfrac{a_i}{b_j})<\max(\dfrac{1}{b_j},\dfrac{a_j}{b_i})\\
$$

由于 $\dfrac{a_i}{b_j}\ge\dfrac{1}{b_j}$ 且 $\dfrac{a_j}{b_i}\ge\dfrac{1}{b_i}$，那么上面的不等式等价于 $\dfrac{a_i}{b_j}<\dfrac{a_j}{b_i}$，即 $a_ib_i<a_jb_j$，按照这个规则排序即可，正确性显然

PS：此题需要高精度，不在本博客讨论范围之内

---

[P2123 皇后游戏](https://www.luogu.com.cn/problem/P2123)

首先可以发现如下事实：

$$
s_i=\sum_{j=1}^ia_j\\
c_i=\max\left(c_{i-1},s_i\right)+b_i\ge c_{i-1}+b_i\ge c_{i-1}
$$

所以有 $\displaystyle\max_{i=1}^nc_i=c_n$，目标变成让 $c_n$ 尽量小

那么我们假设假如第 $i$ 位大臣排在第 $j$ 位大臣前面，且交换 $i$ 和 $j$ 不会导致答案变优，注意到此时并不影响 $i$ 前面的大臣，但是会影响 $j$ 后面的大臣，由于我们要让 $c_n$ 尽量小，所以我们要满足 $c_i<c_j$，即（$p$ 表示 $i$ 前面的大臣）：

$$
\max(\max(c_p,s_p+a_i)+b_i,s_p+a_i+a_j)+b_j\le\max(\max(c_p,s_p+a_j)+b_j,s_p+a_j+a_i)+b_i\\
\max(c_p+b_i+b_j,s_p+a_i+b_i+b_j,s_p+a_i+a_j+b_j)\le\max(c_p+b_j+b_i,s_p+a_j+b_j+b_i,s_p+a_j+a_i+b_i)\\
$$

发现两边都有 $c_p+b_i+b_j$，可以消去，证明如下：

$$
\max(x,a)\le\max(x,b) \iff a\le b
$$

1. 若 $a\le b$：
   1. 若 $x<a$：原式化简为 $a\le b$，显然成立
   2. 若 $a\le x\le b$：原式化简为 $x\le b$，显然成立
   3. 若 $b<x$：原式化简为 $x\le x$，显然成立
2. 若 $a>b$：
   1. 若 $x<b$：原式化简为 $a\le b$，显然不成立
   2. 若 $b\le x< a$：原式化简为 $a\le x$，显然不成立
   3. 若 $a\le x$：原式化简为 $x\le b$，显然不成立

综上所述，命题得证

所以上面的不等式可以化为：

$$
\max(s_p+a_i+b_i+b_j,s_p+a_i+a_j+b_j)\le\max(s_p+a_j+b_j+b_i,s_p+a_j+a_i+b_i)\\
\max(a_i+b_i+b_j,a_i+a_j+b_j)\le\max(a_j+b_j+b_i,a_j+a_i+b_i)\\
\max(b_i,a_j)+a_i+b_j\le\max(b_j,a_i)+a_j+b_i\\
\max(b_i,a_j)-a_j-b_i\le\max(b_j,a_i)-a_i-b_j\\
-\min(b_i,a_j)\le-\min(b_j,a_i)\\
\min(b_i,a_j)\ge\min(b_j,a_i)\\
$$

你可能会认为把上面不等式的等号去掉就可以直接当比较函数排序了，然而有一组 hack 数据：

```plain
input:
2
7
6 3
1 1
7 3
1 1
1 6
1 1
6 10
7
6 10
1 1
6 3
1 1
7 3
1 1
1 6

output:
26
26
```

要知道为什么这种方式会错，我们需要引入一个概念：`Strict Weak Ordering`

可以参考 ouuan 巨佬的[这篇文章](https://ouuan.github.io/post/%E6%B5%85%E8%B0%88%E9%82%BB%E9%A1%B9%E4%BA%A4%E6%8D%A2%E6%8E%92%E5%BA%8F%E7%9A%84%E5%BA%94%E7%94%A8%E4%BB%A5%E5%8F%8A%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98/#%E4%B8%A5%E6%A0%BC%E5%BC%B1%E5%BA%8F)

> 对于一个比较运算符（用 $<$ 表示满足此运算符，$\nless$ 表示不满足此运算符），若满足以下四个条件，则称其是满足严格弱序的：
>
> 1. $x\nless x$（非自反性）
> 2. 若 $x<y$，则 $y\nless x$（非对称性）
> 3. 若 $x<y,y<z$，则 $x<z$（传递性）
> 4. 若 $x\nless y,y\nless x,y\nless z,z\nless y$，则 $x\nless z,z\nless x$（不可比性的传递性）

上面那种比较方法 $\min(b_j,a_i)<\min(b_i,a_j)$，虽然满足前三条规则，但是不满足第四条规则，证明太恶心了，这里不会提到，具体可以看上面那篇文章

那么怎么修正这个比较规则呢？

若 $\min(b_j,a_i)=\min(b_i,a_j)$，由于 $a_i$ 会影响 $c_i$，所以我们可以让 $a$ 小的排在前面，那么比较规则变成了：

$$
\operatorname{cmp}(i,j)=
\begin{cases}
  a_i<a_j & \text{if }\min(b_j,a_i)=\min(b_i,a_j)\\
  \min(b_j,a_i)<\min(b_i,a_j) & \text{otherwise.}
\end{cases}
$$

正确性证明也可以看上面那篇文章

## $\mathrm{II}$ 贪心选取最优增量

通常是每次贪心的选择使答案更优的选法，证明常用反证法

---

> 有一棵 $n$ 个节点的带权树，第 $i$ 条边连接节点 $u_i,v_i$，权值为非负数 $c_i$。你需要选择 $k$ 个节点，使得 $1$ 号节点与这些节点联通的代价最大。

先使 $1$ 号节点为根

结论：$k$ 个节点即为长链剖分前 $k$ 长链的尾节点

证明：

考虑反证法，如果答案里有一个不属于前 $k$ 长链的尾节点的节点，那么有两种情况：

1. 此节点在前 $k$ 长链上：

   ![1.jpg](https://s2.loli.net/2022/10/17/7CcM9IHjhvyLgB5.jpg)
   （本人画技较差，勿喷）

   $y$ 为此节点，$x$ 为对应长链尾节点。如果 $x$ 在答案里面，那么 $y$ 就不可能在答案里面（因为贡献为 $0$），但是如果 $x$ 不在答案里面，那么将 $y$ 替换为 $x$ 显然更优。与前文矛盾
2. 此节点不在前 $k$ 长链上：

   ![2.jpg](https://s2.loli.net/2022/10/17/vStQ9VNXrz271aZ.jpg)

   $y$ 为此节点。可以将 $y$ 替换成某条前 $k$ 长链的尾节点，如果这样不会使答案更优，那么以 $y$ 结尾的长链肯定在前 $k$ 长链里，这时就变成了上一种情况

综上所述，命题得证

加强版为[【ExPR #1】守卫 2](https://pjudge.ac/contest/892/problem/21622)，贪心策略不变，重点在维护长链

## $\mathrm{III}$ 处处取到单个最值

此类贪心通常类似构造题，重点在于如何取到最值

---

[「JOISC 2019 Day4」蛋糕拼接 3](https://loj.ac/p/3039)

先把蛋糕按照 $C_i$ 排序，考虑如何使 $\displaystyle\sum_{i=1}^M|C_{k_j}-C_{k_{j+1}}|$ 最小，显然当 $k_i$ 递增时该式最小，为 $2(k_M-k_1)$。所以考虑枚举左右边界，选出区间内前 $M$ 大的 $V_i$，更新答案。优化此算法需要用到[决策单调性](https://oi-wiki.org/dp/opt/quadrangle/#%E5%9F%BA%E4%BA%8E%E5%88%86%E6%B2%BB%E7%9A%84%E5%86%B3%E7%AD%96%E5%8D%95%E8%B0%83%E6%80%A7%E4%BC%98%E5%8C%96)，本文不再讨论

---

> 有一棵 $n$ 个节点的树（保证 $n$ 为偶数），把这棵树的节点两两配对，求 $\dfrac{n}{2}$ 对点的最大/小距离和

最小距离和：

一条边经过的最小次数：若这条边两端点数为偶数则为 $0$，否则为 $1$。我们可以取到这个解

构造方法：先设一个根，从根开始遍历这棵树。对于当前节点，先配对它的所有子树，然后对没有被配对到的儿子节点两两配对，剩下来的（如果有）和当前节点配对

最大距离和：

一条边经过的最大次数为 $\min(\text{一端节点数量}, \text{另一端节点数量})$。我们可以取到这个解

构造方法：先找到这棵树的重心，设它为根，然后求出这棵树的 dfs 序，把 dfs 序中的第 $i$ 个点和第 $i+\dfrac{n}{2}$ 个点配对

为 [CF1396E](https://codeforces.com/problemset/problem/1396/E) 的弱化版

---

通过上述两道例题可以看出这种类型的贪心更加偏向于构造，重点在于大胆猜想。毕竟猜几个做法对拍比证明一个做法快多了（（（

或者用学长兼队爷@[玄燕本燕](https://www.luogu.com.cn/user/89645)的一句话：写贪心题目重点在对拍和快速叉掉你的做法（

## $\mathrm{IV}$ 减少决策范围

通常是利用贪心带来的某些性质优化状态

---

[arc096f](https://atcoder.jp/contests/arc096/tasks/arc096_d)

> 有 $n$ 种物品和 $x$ 个材料，制作一个第 $i$ 种物品需要 $m_i$ 的材料。同时有一个整数 $d$，假设第 $i$ 种物品（$2\le i\le n$）制作了 $c_i$ 个，给定 $p_i$（$1\le p_i<i$），需满足 $c_{p_i}\le c_i\le c_{p_i}+d$。最大化 $\sum_{i=1}^nc_i$
> 
> $1\le n\le50,\ 1\le x,m_i\le 10^9，0\le d\le 10^9$

神仙题，场上居然有人切了，震撼/fad

首先不难发现可以将 $(p_i,i)$ 连边，结果一定是一棵以 $1$ 为根的树，将 $c_i$ 树上差分后，限制变成 $0\le c_i\le d$，同时选择这个点相当于选择这棵子树，所以设 $v_i=size_i,w_i=\sum_{j\in sub_i}m_j$，那么原题变成一道多重背包题

但是由于 $0\le d\le 10^9$，所以（据我所知）没有能在正确的复杂度里做多重背包的算法

有一个小优化：把状态 $f_{i,j}$ 设计为前 $i$ 种物品里价值为 $j$ 时的最小重量，但是由于总价值依旧很大，所以并不能起到什么作用

这时我们想到一个著名的假做法：按性价比 $\dfrac{v_i}{w_i}$ 从大到小排序，如果能选就选

虽然这是假的，但是可以发现一个性质：如果有两种物品 $i,j$，且 $\dfrac{v_i}{w_i}>\dfrac{v_j}{w_j}$，那么如果我们选择了 $v_i$ 个第 $j$ 种物品，显然换成 $v_j$ 个第 $i$ 种物品会使答案更优

证明：由 $\dfrac{v_i}{w_i}>\dfrac{v_j}{w_j}$ 可以得到 $v_iw_j>v_jw_i$，交换后总价值不变，但是总体积变小，所以更优

由此可以推出一个性质：最终答案中 $c_i\le d-v_j,c_j\ge v_i$ 不可能出现

证明：若 $c_i\le d-v_j,c_j\ge v_i$，那么我们显然可以把 $v_i$ 个第 $j$ 种物品换成 $v_j$ 个第 $i$ 种物品，答案不会更劣

把这个条件适当放宽得到对于任意满足 $\dfrac{v_i}{w_i}>\dfrac{v_j}{w_j}$ 的 $i,j$，有 $c_i>d-n$ 或 $c_j<n$

把最终答案对应的图画出来

![3.jpg](https://s2.loli.net/2022/10/18/afhdkwqvgjA9EVu.jpg)

发现红框部分可以直接多重背包，剩下的部分正好满足贪心的性质（前面能选就选），所以可以枚举背包的每个最终状态，贪心计算答案，更新答案即可，复杂度瓶颈在背包，为 $O(n^4\log n)$

---

这类题通常都是神仙题，反正就是挺难的（
